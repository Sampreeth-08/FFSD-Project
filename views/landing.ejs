<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Celestial</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/728d3c0089.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <style>
        .back-video {
            position: absolute;
            right: 0;
            bottom: 0;
            z-index: -1;
        }

        @media (min-aspect-ratio: 16/9) {
            .back-video {
                width: 100%;
                height: auto;
            }
        }

        @media (max-aspect-ratio: 16/9) {
            .back-video {
                width: auto;
                height: 100%;
            }
        }
    </style>

</head>

<body>
    <section class="forms-section">
        <video autoplay loop muted plays-inline class="back-video">
            <source src="/img/back.mp4" type="video/mp4">
        </video>
        <h1 class="section-title">Celestial</h1>
        <div class="forms">
            <div class="form-wrapper is-active">
                <button type="button" class="switcher switcher-login">
                    Login
                    <span class="underline"></span>
                </button>
                <form class="form form-login" id="form-login" method="post" action="/login">
                    <p id="error_message1" class="text-center alert-danger">
                        <% %>
                    </p>
                    <fieldset>
                        <legend>Please, enter your email and password for login.</legend>
                        <div class="input-block">
                            <label for="login-username">E-mail</label>
                            <input id="login-username" type="email" placeholder="Enter your email" name="login_email"
                                required>
                        </div>
                        <div class="input-block">
                            <label for="login-password">Password</label>
                            <input id="login-password" type="password" placeholder="Enter your password"
                                name="login_password" required>
                        </div>
                    </fieldset>
                    <button type="submit" id="login" class="btn-login">Login</button>
                </form>
            </div>


            <div class="form-wrapper">
                <button type="button" class="switcher switcher-signup">
                    Sign Up
                    <span class="underline"></span>
                </button>
                <form class="form form-signup" id="form-signup" method="post" action="/signup">
                    <p id="error_message2" class="text-center alert-danger"></p>
                    <fieldset>
                        <legend>Please, enter your email, password and password confirmation for sign up.</legend>
                        <div class="input-block">
                            <label for="signup-username">Username</label>
                            <input id="signup-username" type="text" placeholder="Enter your username"
                                name="signup_username" required>
                        </div>
                        <div class="input-block">
                            <label for="signup-email">E-mail</label>
                            <input id="signup-email" type="email" placeholder="Enter your email" name="signup_email"
                                required>
                        </div>
                        <div class="input-block">
                            <label for="signup-password">Password</label>
                            <input id="signup-password" type="password" placeholder="Enter your password"
                                name="signup_password" required>
                        </div>
                    </fieldset>
                    <button type="submit" id="signup" class="btn-signup">Sign Up</button>
                </form>
            </div>
        </div>
    </section>
    <script>
        const switchers = [...document.querySelectorAll('.switcher')]

        switchers.forEach(item => {
            item.addEventListener('click', function () {
                switchers.forEach(item => item.parentElement.classList.remove('is-active'))
                this.parentElement.classList.add('is-active')
            })
        })


        const login = document.getElementById('login');
        let error_message1 = document.getElementById('error_message1');
        login.addEventListener('click', function () {
            console.log(email, password);
            fetch('/landing', {
                method: 'post',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: login_email,
                    password: login_password
                })
            }).then(res => {
                res.json()
            }).then(data => {
                console.log(data)
                if (data.error) {
                    error_message1.innerHTML = data.error;
                }
            })
        })

        const signup = document.getElementById('signup');
        let error_message2 = document.getElementById('error_message2');
        signup.addEventListener('click', function () {
            fetch('/landing', {
                method: 'post',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: signup_username,
                    password: signup_password,
                    email: signup_email
                })
            }).then(res => {
                res.json()
            }).then(data => {
                console.log(data)
                if (data.error) {
                    error_message2.innerHTML = data.error;
                }
            })
        })


        let form = document.getElementById('form-login')
        let form1 = document.getElementById('form-signup')
        function verifyForm1() {
            let email = document.getElementById("login-username").value;
            let regemail = /^[a-zA-Z0-9+_.-]+@[a-zA-Z0-9.-]+$/;
            let error_message = document.getElementById('error_message1');
            let str = ``;
            if (!regemail.test(email)) {
                str += `Invalid Email Address`
            }
            if (str !== ``) {
                error_message.innerHTML = str
                return false
            }
            return true;
        }
        function verifyForm2() {
            let password = document.getElementById('signup-password').value;
            let error_message = document.getElementById('error_message2');
            let user = document.getElementById("signup-username").value;
            let reguser = /^(?=.{8,20}$)(?![_.])(?!.*[_.]{2})[a-zA-Z0-9._]+(?<![_.])$/;
            let repassword = /^(?=.*[!@#$&*])(?=.*[0-9].*[0-9]).{8}$/;
            let str = ``;
            if (!reguser.test(user)) {
                str += `Username should only contain (8-20) characters <br> (alphabet digits _ .) , <br> where consecutive special characters are not allowed <br> and username is not allowed to start or end with .<br>`
            }
            if (!repassword.test(password)) {
                str += `Ensure password has one special case letter.<br>Ensure password has two digits.<br>Ensure password is of length 8.<br>`
            }
            if (str !== ``) {
                error_message.innerHTML = str
                return false
            }
            return true;
        }

        document.getElementById('form-login').addEventListener('submit', (e) => {
            e.preventDefault();
            if (verifyForm1()) {
                form.submit();
            }
        })
        document.getElementById('form-signup').addEventListener('submit', (e) => {
            e.preventDefault();
            if (verifyForm2()) {
                form1.submit();
            }
        })
    </script>
</body>

</html>